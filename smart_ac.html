<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WIUC Smart AC Simulation ‚Äî GROUP 5 (ERNEST & ALEX)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --bg:#071027; --card:#071827; --muted:#9fb0c8; --accent:#60a5fa; --good:#34d399; --warn:#f59e0b; --danger:#fb7185;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#061224 0%, #071027 100%);color:#e6eef8}
    .wrap{max-width:1200px;margin:28px auto;padding:18px}
    .header{display:flex;gap:12px;align-items:center}
    h1{margin:0;font-size:22px}
    .subtitle{color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns:360px 1fr;gap:16px;margin-top:16px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:14px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}

    /* left panel */
    .left .temp{display:flex;flex-direction:column;align-items:center;gap:8px}
    .temp .value{font-size:56px;font-weight:800}
    .temp .unit{font-size:14px;color:var(--muted)}
    .controls{margin-top:12px;display:flex;flex-direction:column;gap:12px}
    .modes{display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.03);padding:8px 10px;border-radius:10px;color:inherit;cursor:pointer}
    .btn.active{background:var(--accent);color:#001;box-shadow:0 8px 20px rgba(96,165,250,0.12)}
    .toggle-row{display:flex;gap:8px}
    .chip{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:13px}

    /* right panel */
    .right .charts{display:grid;grid-template-columns:1fr 320px;gap:12px}
    canvas{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:10px}

    /* waveform panel */
    .wave-panel{background:rgba(0,0,0,0.36);border-radius:10px;padding:8px;display:flex;flex-direction:column;gap:8px}
    .wave-canvas{width:100%;height:140px;border-radius:8px;display:block}
    .wave-legend{display:flex;justify-content:space-between;color:var(--muted);font-size:13px}

    .log{max-height:220px;overflow:auto;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px}
    .log-item{font-size:13px;padding:6px;border-bottom:1px dashed rgba(255,255,255,0.02)}

    .status-row{display:flex;gap:8px;align-items:center;margin-top:8px}
    .occupancy{font-weight:700}

    .about-toggle{background:transparent;border:none;color:var(--muted);cursor:pointer;font-size:13px}
    .about-panel{max-height:0;overflow:hidden;transition:max-height .35s ease,opacity .35s;opacity:0}
    .about-panel.open{max-height:240px;opacity:1}
    .about-content{padding:10px;color:var(--muted);font-size:13px}

    .small{font-size:12px;color:var(--muted)}

    /* loading overlay */
    .loading{position:fixed;inset:0;background:linear-gradient(180deg,#02101b,#041627);display:flex;align-items:center;justify-content:center;z-index:80}
    .loader{color:#cfe9ff;font-size:18px;padding:24px;border-radius:12px;background:rgba(255,255,255,0.02);box-shadow:0 8px 30px rgba(0,0,0,0.6)}

    /* responsive */
    @media (max-width:980px){.grid{grid-template-columns:1fr;}.right .charts{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="loading" id="loading"><div class="loader">Initializing Smart AC System‚Ä¶</div></div>

  <div class="wrap" id="app" style="visibility:hidden">
    <div class="header">
      <div>
        <h1>WIUC Smart AC Simulation ‚Äî GROUP 5 (ERNEST & ALEX)</h1>
        <div class="subtitle">Presence-aware, self-regulating climate control with diagnostics</div>
      </div>
      <div style="margin-left:auto;color:var(--muted);font-size:13px">Simulation started: <span id="startTime"></span></div>
    </div>

    <div class="grid" style="margin-top:14px">
      <div class="card left">
        <div class="temp">
          <div class="value" id="currentTemp">24.0<span style="font-size:18px">¬∞C</span></div>
          <div class="unit" id="acState">Mode: AUTO ‚Ä¢ <span id="acStatus">Idle</span></div>
        </div>

        <div class="controls">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div>
              <button id="powerBtn" class="btn active">Power ON</button>
            </div>
            <div style="text-align:right">
              <div class="small">Estimated Power</div>
              <div id="energy" style="font-weight:700">0.000 kWh</div>
            </div>
          </div>

          <div>
            <div class="small">Setpoint: <span id="setLabel">22¬∞C</span></div>
            <input id="setTemp" type="range" min="16" max="30" step="0.5" value="22" style="width:100%" />
          </div>

          <div>
            <div class="small">Mode</div>
            <div class="modes">
              <button class="btn" data-mode="cool">COOL</button>
              <button class="btn" data-mode="heat">HEAT</button>
              <button class="btn" data-mode="fan">FAN</button>
              <button class="btn" data-mode="eco">ECO</button>
              <button class="btn active" data-mode="auto">AUTO</button>
            </div>
            <div class="status-row" style="margin-top:8px">
              <div class="chip">Hysteresis: <span id="deadband">0.8¬∞C</span></div>
              <div class="chip">Fan: <span id="fanSpeed">Auto</span></div>
            </div>
            <div style="margin-top:8px">
              <div class="small">Room: <span id="occupancy" class="occupancy">Empty</span></div>
            </div>
          </div>

          <div style="display:flex;align-items:center;justify-content:space-between;margin-top:6px">
            <div>
              <button class="about-toggle" id="aboutToggle">‚ÑπÔ∏è About Smart AC</button>
            </div>
            <div class="small">Last update: <span id="lastUpdate">--:--:--</span></div>
          </div>

          <div class="about-panel" id="aboutPanel"><div class="about-content">
            The WIUC Smart AC automatically detects whether the room is occupied, reads current temperature, and adjusts heating or cooling to reach the desired setpoint. ECO mode reduces power use at the cost of slower change. The system logs activity and provides maintenance alerts when it detects component issues.
          </div></div>

        </div>

      </div>

      <div class="card right">
        <div class="charts">
          <div>
            <canvas id="tempChart"></canvas>
            <div class="small" style="margin-top:6px">Temperature & Power (last 20 updates)</div>
          </div>

          <div>
            <div class="wave-panel">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div style="font-weight:700">Temperature Activity</div>
                <div class="small" id="waveExtra">Status</div>
              </div>
              <canvas id="waveCanvas" class="wave-canvas"></canvas>
              <div class="wave-legend"><div id="waveMode">Mode: --</div><div id="waveSpeed">Speed: --</div></div>
            </div>

            <div style="margin-top:10px;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div style="font-weight:700">System Log</div>
                <div class="small">Entries: <span id="logCount">0</span></div>
              </div>
              <div id="log" class="log" style="margin-top:8px"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // ---------- state
    const state = {
      power:true, mode:'auto', desired:22, current:24, ambient:30,
      occupied:false, acOn:false, energy:0, deadband:0.8, fan:'Auto', health:'OK', lastBeep:0
    }

    // ---------- UI refs
    const app = document.getElementById('app');
    const loading = document.getElementById('loading');
    const startTimeEl = document.getElementById('startTime');
    const currentTempEl = document.getElementById('currentTemp');
    const acStateEl = document.getElementById('acState');
    const acStatusEl = document.getElementById('acStatus');
    const setTemp = document.getElementById('setTemp');
    const setLabel = document.getElementById('setLabel');
    const energyEl = document.getElementById('energy');
    const occupancyEl = document.getElementById('occupancy');
    const aboutToggle = document.getElementById('aboutToggle');
    const aboutPanel = document.getElementById('aboutPanel');
    const lastUpdateEl = document.getElementById('lastUpdate');
    const logEl = document.getElementById('log');
    const logCountEl = document.getElementById('logCount');
    const deadbandEl = document.getElementById('deadband');
    const fanSpeedEl = document.getElementById('fanSpeed');
    const waveModeEl = document.getElementById('waveMode');
    const waveSpeedEl = document.getElementById('waveSpeed');

    // show start time and hide loader
    const started = new Date();
    startTimeEl.textContent = started.toLocaleTimeString();
    setTimeout(()=>{ loading.style.display='none'; app.style.visibility='visible'; }, 900);

    // ---------- logging
    const logs = [];
    function log(msg){ const t=new Date(); const line = t.toLocaleTimeString()+ ' ‚Äî '+msg; logs.unshift(line); renderLog(); }
    function renderLog(){ logEl.innerHTML = logs.slice(0,200).map(l=>' <div class="log-item">'+l+'</div>').join(''); logCountEl.textContent = logs.length; }

    // ---------- chart.js temperature + power
    const ctx = document.getElementById('tempChart').getContext('2d');
    const chartData = { labels:[], datasets:[{label:'Room (¬∞C)',data:[],borderColor:'#60a5fa',tension:0.3,fill:false},{label:'Target (¬∞C)',data:[],borderColor:'#34d399',borderDash:[6,4],tension:0.1,fill:false},{label:'Energy (kWh)',data:[],borderColor:'#f59e0b',tension:0.3,yAxisID:'y1',fill:false}] };
    const chart = new Chart(ctx,{ type:'line', data:chartData, options:{ responsive:true, interaction:{mode:'index',intersect:false}, scales:{ y:{ type:'linear',position:'left'}, y1:{ type:'linear',position:'right',grid:{drawOnChartArea:false} } } }});

    // ---------- waveform canvas
    const waveCanvas = document.getElementById('waveCanvas');
    const wctx = waveCanvas.getContext('2d');
    let waveW, waveH;
    function resizeWave(){ waveW = waveCanvas.width = waveCanvas.clientWidth*devicePixelRatio; waveH = waveCanvas.height = waveCanvas.clientHeight*devicePixelRatio; }
    window.addEventListener('resize', resizeWave);
    resizeWave();

    // wave animation state
    let waveOffset = 0;
    function drawWave(dt){
      // background
      wctx.clearRect(0,0,waveW,waveH);
      wctx.fillStyle = 'rgba(0,0,0,0.12)';
      wctx.fillRect(0,0,waveW,waveH);

      // determine mode & speed based on temperature change
      const diff = state.desired - state.current; // positive => need heating
      let mode='stable';
      if(Math.abs(diff) > 0.3){ mode = diff < 0 ? 'cooling' : 'heating'; }
      let speedFactor = Math.min(1.8, Math.max(0.2, Math.abs(diff)/2 + 0.2));
      if(!state.occupied || !state.power) speedFactor *= 0.35; // fade when idle

      // color and glow
      let color='rgba(100,210,255,0.9)';
      if(mode==='cooling') color='rgba(96,165,250,0.95)';
      else if(mode==='heating') color='rgba(250,180,90,0.95)';
      else color='rgba(120,220,140,0.9)';

      // glow layers
      for(let layer=4; layer>=1; layer--){
        wctx.beginPath();
        const amplitude = 6*layer*(0.6 + speedFactor);
        const freq = 0.004 * (1+layer*0.4) * (1+speedFactor);
        wctx.moveTo(0,waveH/2);
        for(let x=0;x<waveW;x+=6*devicePixelRatio){
          const y = waveH/2 + Math.sin((x*freq)+waveOffset*0.01 + layer) * amplitude;
          wctx.lineTo(x,y);
        }
        wctx.lineWidth = 2.5*layer*devicePixelRatio;
        // set composite color with decreasing alpha
        const alpha = 0.08 * layer;
        wctx.strokeStyle = color.replace('0.9',alpha.toFixed(2));
        wctx.shadowBlur = 12*layer*speedFactor;
        wctx.shadowColor = color;
        wctx.stroke();
      }

      // central bright line
      wctx.beginPath();
      const amp = 8 * (0.6 + speedFactor);
      const fr = 0.006 * (1+speedFactor);
      for(let x=0;x<waveW;x+=4*devicePixelRatio){
        const y = waveH/2 + Math.sin((x*fr)+waveOffset*0.02) * amp;
        if(x===0) wctx.moveTo(x,y); else wctx.lineTo(x,y);
      }
      wctx.lineWidth = 2.5*devicePixelRatio;
      wctx.strokeStyle = color;
      wctx.shadowBlur = 24*speedFactor;
      wctx.shadowColor = color;
      wctx.stroke();

      // update offset
      waveOffset += (2 + 6*speedFactor) * (dt/16);

      // legend updates
      waveModeEl.textContent = 'Mode: ' + (mode==='cooling'?'Cooling':mode==='heating'?'Heating':'Stable');
      waveSpeedEl.textContent = 'Activity: ' + (speedFactor.toFixed(2));

      // fade-out when idle
      if((!state.occupied || !state.power) && Math.abs(diff) < 0.3){
        waveCanvas.style.opacity = Math.max(0, (Math.abs(diff)/0.3));
      } else waveCanvas.style.opacity = 1;
    }

    // animate
    let lastTs = performance.now();
    function animate(ts){
      const dt = ts - lastTs; lastTs = ts;
      drawWave(dt);
      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);

    // ---------- beep control (softer and less frequent)
    const beep = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');
    beep.volume = 0.22;
    function maybeBeep(){ const now=Date.now(); if(now - state.lastBeep > 7000){ state.lastBeep = now; try{ beep.currentTime=0; beep.play(); }catch(e){} } }

    // ---------- logic: presence, health, regulation
    function randPresence(){ if(Math.random()<0.09) state.occupied = !state.occupied; }
    function randHealth(){ const r=Math.random(); if(r<0.0015){ state.health='Filter'; log('Maintenance: Filter replacement recommended'); alertBox('‚ö†Ô∏è Filter replacement recommended','warn'); } else if(r<0.0023){ state.health='Compressor'; log('Critical: Compressor malfunction'); alertBox('üö® Compressor malfunction detected','danger'); } }

    const alertBoxEl = document.getElementById('alertBox');
    function alertBox(msg, level='good'){ alertBoxEl.textContent = msg; alertBoxEl.className = 'alert '+(level==='good'?'good':level==='warn'?'warn':'danger'); }

    function regulate(){
      if(!state.power){ acStatusEl.textContent='Offline'; return; }
      const diff = state.desired - state.current;
      const absd = Math.abs(diff);
      // occupancy relax behavior
      if(!state.occupied){ acStatusEl.textContent='Room Empty'; }
      // decide ON/OFF and adjust temp
      if(state.occupied && absd>0.3){
        state.acOn = true;
        if(diff < 0){ // cooling
          state.current -= (state.mode==='eco'?0.03:0.09);
          acStatusEl.textContent = 'Cooling';
        } else { // heating
          state.current += (state.mode==='eco'?0.03:0.09);
          acStatusEl.textContent = 'Heating';
        }
        // energy usage
        state.energy += (state.mode==='eco'?0.0008:0.0016);
        maybeBeep();
        log('Adjusted temperature to '+state.current.toFixed(1)+'¬∞C');
      } else {
        state.acOn = false;
        if(state.power) acStatusEl.textContent = state.occupied ? 'Stable' : 'Idle';
      }

      // passive drift to ambient when off
      if(!state.acOn){ const drift = (state.ambient - state.current) * 0.002; state.current += drift; }

      // maintenance auto message reset
      if(state.health==='OK') alertBox('System Normal','good');
    }

    // ---------- interactions
    powerBtn.addEventListener('click', ()=>{ state.power=!state.power; powerBtn.classList.toggle('active', state.power); powerBtn.textContent = state.power ? 'Power ON' : 'Power OFF'; log(state.power? 'Powered ON':'Powered OFF'); maybeBeep(); });
    document.querySelectorAll('[data-mode]').forEach(b=> b.addEventListener('click',(e)=>{ document.querySelectorAll('[data-mode]').forEach(x=>x.classList.remove('active')); b.classList.add('active'); state.mode=b.dataset.mode; log('Mode -> '+state.mode.toUpperCase()); maybeBeep(); }));
    setTemp.addEventListener('input', ()=>{ state.desired = parseFloat(setTemp.value); setLabel.textContent = state.desired+'¬∞C'; });
    aboutToggle.addEventListener('click', ()=>{ aboutPanel.classList.toggle('open'); });

    // ---------- periodic updates
    function tick(){ randPresence(); randHealth(); regulate(); updateUI(); recordChart(); lastUpdateEl.textContent = new Date().toLocaleTimeString(); }
    setInterval(tick,1000);

    // ---------- UI updates and chart recording
    function updateUI(){ currentTempEl.innerHTML = state.current.toFixed(1)+ '<span style="font-size:14px">¬∞C</span>'; acStateEl.innerHTML = 'Mode: '+state.mode.toUpperCase()+' ‚Ä¢ <span id="acStatus">'+acStatusEl.textContent+'</span>'; occupancyEl.textContent = state.occupied? 'Occupied' : 'Empty'; energyEl.textContent = state.energy.toFixed(3)+' kWh'; deadbandEl.textContent = state.deadband+'¬∞C'; fanSpeedEl.textContent = state.fan; }

    function recordChart(){ const now = new Date().toLocaleTimeString(); chartData.labels.push(now); chartData.datasets[0].data.push(state.current.toFixed(1)); chartData.datasets[1].data.push(state.desired); chartData.datasets[2].data.push(state.energy.toFixed(3)); if(chartData.labels.length>20){ chartData.labels.shift(); chartData.datasets.forEach(ds=>ds.data.shift()); } chart.update(); }

    // ---------- init
    setLabel.textContent = state.desired+'¬∞C'; updateUI(); log('Simulation started');
    function alertStartup(){ alertBox('System Normal','good'); }
    alertStartup();

  </script>
</body>
</html>
